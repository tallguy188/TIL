## How Does the Internet Work?



### Where to Begin?  Internet Addresses

------

인터넷은 각각 컴퓨터들이 연결되어 있는 글로벌 네트워크이기 때문에 반드시 각각 고유한 주소를 가지고 있어야 한다. 인터넷 주소의 form은 `nnn.nnn.nnn.nnn`(n은 반드시 숫자 0-255 사이어야 함)이다. 이 주소는 우리에게 `IP 주소`라고 알려져 있다. 아래의 일러스트는 두 컴퓨터가 인터넷으로 연결되어 있는 것을 보여준다. 여기서 인터넷은 두 컴퓨터 사이의 추상적인 객체로 표현되어 있다. 

![Diagram 1](http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag1.gif)

`ISP`(인터넷 서비스 공급자)를 통해 인터넷에 연결하는 경우 일반적으로 전화 접속 세션 동안 임시 IP주소가 할당된다. `LAN(Local Area Network)`에서 인터넷에 연결하는 경우 컴퓨터에 영구 IP주소가 있거나`DHCP(Dynamic Host Configuration Protocol)` 서버에서 임시 주소를 얻을 수 있다. 어쨌든 인터넷에 연결되어 있으면 컴퓨터에는 고유한 IP주소가 있다. 

>체크아웃 - ping program
>
>마이크로 소프트나 유닉스 계열을 사용중이고 인터넷에 연결되어 있는 경우 컴퓨터의 인터넷이 살아있는지 확인하는 방법이 있다. 이것은 `ping`이라고 불린다. 



### Protocol Stacks and Packets

------

컴퓨터는 인터넷에 연결되어 있으며 고유한 주소를 가지고 있다. 인터넷에 연결된 다른 컴퓨터와 어떻게 '대화'를 할까? 여기서 예시가 나온다. 만약 IP주소가 1.2.3.4이고 IP주소가 5.6.7.8인 컴퓨터에게 메시지를 보내려고 한다. 보내려는 메시지는 "Hello computer"이다. 분명히 메시지는 컴퓨터를 인터넷에 연결하는 전선을 통해 전송되어야 한다. 집에서 ISP에 전화를 걸어 메시지를 전화선을 통해 전송해야 한다고 가정하자. 따라서 메시지는 알파벳 텍스트에서 전자 신호로 번역되어 인터넷을 통해 전송된 다음 다시 알파벳 텍스트로 번역되어야 한다. 이것은 **프로토콜 스택** 을 사용하여 이루어진다. 모든 컴퓨터는 인터넷에서 통신하기 위해 이것이 필요하며 일반적으로 컴퓨터의 운영 체제에 내장되어 있다. 인터넷에서 사용되는 프로토콜 스택은 두가지 주요 통신 프로토콜 때문에 `TCP/IP`프로토콜 스택이라고 불린다. 

![다이어그램 2](http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag2.gif)

* 메시지는 컴퓨터의 프로토콜 스택 맨 위에서 시작하여 아래쪽으로 이동한다.
* 보낼 메시지가 길면 메시지가 통과하는 각 스택 계층에서 메시지를 더 작은 데이터 청크로 나눌 수 있다. 이는 인터넷을 통해 전송된 데이터가 관리 가능한 청크로 전송되기 떄문이다. 인터넷에서는 이러한 데이터 청크를 **패킷** 이라고 한다. 
* 패킷은 응용 프로그램 계층을 통과하여 TCP계층으로 이어진다. 각 패킷에는 포트 번호가 할당된다. 
* TCP계층을 거친 후 패킷은 IP계층으로 이동한다 .여기에서 각 패킷이 대상 주소인 5.6.7.8을 수신한다. 
* 이제 메시지 패킷에 포트 번호와 IP주소가 있으므로 인터넷을 통해 보낼 준비가 된것이다. 하드웨어 계층은 메시지의 알파벳 텍스트를 포함하는 패킷을 전자 신호로 변환하고 전화선을 통해 전송한다.
* 전화선의 다른 쪽 끝에는 ISP가 인터넷에 직접 연결되어 있다. ISP라우터는 각 패킷의 대상 주소를 검사하고 보낼 위치를 결정한다. 
* 결국 패킷은 컴퓨터 5.6.7.8에 도달한다. 여기에서 패킷은 대상 컴퓨터의 TCP/IP스택 맨 아래에서 시작하여 위쪽으로 작동한다. 
* 패킷이 스택을 통해 위쪽으로 이동하면 보내는 컴퓨터의 스택이 추가한 모든 라우팅 데이터가 패킷에서 제거된다. 
* 데이터가 스택의 맨 위에 도달하면 패킷이 원래 형식인 "Hello computer"로 다시 조립된다. 

### Networking Infra

------

이제 패킷이 인터넷을 통해 한 컴퓨터에서 다른 컴퓨터로 이동하는 방법을 알게 되었다. 그러나 그 사이에 무엇이 있을까? 실제로 인터넷을 구성하는 것은 무엇일까?

![다이어그램 3](http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag3.gif)

위에는 더 자세한 다이어그램이다. 

ISP는 전화 접속 고객을 위해 모뎀 풀을 유지관리한다. 이는 모뎀 풀에서 백본 또는 전용 회선 라이터로의 데이터 흐름을 제어하는 컴퓨터에 의해 관리된다. 이 설정은 네트워크에 대한 접근을 제공하므로 포트 서버라고 할 수 있다. 

패킷이 전화 네트워크와 ISP의 로컬 장비를 통과한 후 패킷은 ISP의 백본 또는 ISP가 대역폭을 사는 백본으로 라우팅된다. 여기에서 패킷은 목적지인 주소가 5.6.7.8인 컴퓨터를 찾을 때까지 일반적으로 여러 라우터와 여러 백본, 전용 회선 및 기타 네트워크를 통해 이동한다. 그러나 만약 우리 패킷이 정확한 경로를 알고 있다면 더 좋지 않을까? 방법이 있다. 

>체크 아웃 - Traceroute 프로그램
>
>윈도우나 유닉스 계열을 사용하고, 인터넷에 연결되어 있다면 편리한 프로그램이 있다. 이것은 Traceroute라고 하며 패킷이 주어진 인터넷 목적지로 가는 경로를 보여준다. Ping과 마찬가지로 명령 프롬프트에서 traceroute를 사용해야 한다. Ping과 마찬가지로 도메인 이름 대신 IP주소를 입력할 수도 있다. Traceroute는 패킷이 목적지에 도달하기 위해 통과해야 하는 모든 라우터, 컴퓨터 및 기타 인터넷 엔티티의 목록을 인쇄한다. 

Traceroute를 사용하면 패킷이 목적지에 도달하기 위해 많은 것을 거쳐야 하는 것을 알 수 있다. 

### Internet Infrastructure

------

인터넷 백본은 서로 상호 연결되는 대규모 네트워크로 구성된다. 이러한 대규모 네트워크를 **네트워크 서비스 공급자** 또는 **NSP**라고 한다. 이러한 네트워크는 서로 패킷 트래픽을 교환한다. 각 NSP는 3개의 네트워크 액세스 포인트 또는 NAP에 연결해야 한다. NAP에서 패킷 트래픽은 한 NSP의 백본에서 다른 NSP의 백본으로 이동할 수 있다.  NSP는 수도권 교환 장소 또는 MAE에서 상호연결한다. MAE는 NAP와 동일한 용도이지만 개인 소유이다. NAP는 원래 인터넷 상호 연결 지점이었다. NAP와 MAE는 모두 `Internet Exchange Points` 또는 `IX` 라고 한다. NSP는 또한 ISP 및 소규모 대역폭 공급자와 같은 소규모 네트워크에 대역폭을 판매한다. 아래는 이 계층적 인프라를 보여주는 그림이다. 

![다이어그램 4](http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag4.gif)



### The Internet Routing Hierarchy

------

그렇다면 패킷은 인터넷에서 어떻게 길을 찾을 수 있을까? 인터넷에 연결된 모든 컴퓨터는 다른 컴퓨터의 위치를 알고있을까? 패킷은 단순히 모든 컴퓨터의 인터넷에 브로드캐스트 될까? 앞의 두 질문에 대한 대답은 "아니오"이다. 어떤 컴퓨터도 다른 컴퓨터가 어디에 있는지 알지 못하며, 패킷이 모든 컴퓨터에 전송되지는 않는다. 패킷을 목적지로 가져오는 데 사용되는 정보는 인터넷에 연결된 각 라우터가 보관하는 라우팅 테이블이다. 

**라우터는 패킷 스위치이다.** 라우터는 일반적으로 네트워크 간에 연결되어 패킷을 라우팅한다. 각 라우터는 하위 네트워트와 사용하는 IP주소를 알고 있다. 라우터는 일반적으로 라우터의 '위'에 있는 IP주소를 알지 못한다. 

패킷이 라우터에 도착하면 라우터는 발신 컴퓨터의 IP 프로토콜 계층에서 지정한 IP주소를 검사한다. 라우터는 라우팅 테이블을 확인한다. IP주소가 포함된 네트워크가 발견되면 패킷이 해당 네트워크로 전송된다. IP주소가 포함된 네트워크를 찾을 수 없는 경우 다음 라우터가 패킷을 보낼 위치를 알 수 있기를 희망하며 라우터는 기본 경로, 일반적으로 백본 계층에서 다음 라우터로 패킷을 보낸다. 만약 다음 라우터도 위치를 알 수 없으면 패킷이 NSP백본에 도달할 떄까지 다시 위쪽으로 라우팅된다. NSP백본에 연결된 라우터는 가장 큰 라우팅 테이블을 보유하고 여기에서 패킷은 올바른 백본으로 라우팅되어 "하향하는" 여행을 시작한다. 

### Domain Names and Address Resolution

------

그러나 만약 연결하려는 컴퓨터의 IP주소를 모른다면 어떻게 될까? 만약 www.another computer.com이라는 웹 서버에 엑세스 해야 하는 경우에는 어떻게 할까? 웹 브라우저는 이 컴퓨터가 인터넷에서 어디에 있는지 어떻게 알 수 있을까? 이 모든 질문에 대한 답은 `Domain Name Service` 또는 `DNS`이다. `DNS`는 인터넷에서 컴퓨터 이름과 해당 IP주소를 추적하는 분산 데이터베이스이다. 

인터넷에 연결된 많은 컴퓨터는 DNS데이터베이스의 일부와 다른 사람이 엑세스할 수 있도록 하는 소프트웨어를 호스트한다. 이러한 컴퓨터를 DNS서버라고 한다. 전체 데이터베이스를 포함하는 DNS서버는 없다. 컴퓨터는 전체 데이터베이스의 부분만 포함한다. DNS 서버에 다른 컴퓨터에서 요청한 도메인 이름이 없으면 DNS서버는 요청 컴퓨터를 다른  DNS 서버로 리디렉션 한다. 

![다이어그램 6](http://web.stanford.edu/class/msande91si/www-spr04/readings/week1/InternetWhitepaper_files/ruswp_diag6.gif)

`Domain Name Service`는 IP 라우팅 계층 구조와 유사한 계층 구조로 구성된다. 이름 확인을 요청하는 컴퓨터는 요청에서 도메인 이름을 확인할 수 있는 DNS서버를 찾을 때까지 계층 구조의 '위로' 리디렉션 된다. 위의 그림은 계층 구조의 일부를 보여준다. 트리의 맨 위에 도메인 루트가 있다. 더 오래되고 더 일반적인 도메인들은 상단 근처에서 볼 수 있다. 표시되지 않은 나머지 계층 구조를 형성하는 것은 전 세계의 수많은 DNS서버이다. 

인터넷 연결이 설정되면 일반적으로 하나의 기본 DNS서버와 하나 이상의 보조 DNS서버가 설치된다. 이렇게 하면 도메인 이름 확인이 필요한 모든 인터넷 응용 프로그램이 올바르게 작동할 수 있다. 예를 들어 웹 브라우저에 웹 주소를 입력하면 브라우저는 먼저 기본 DNS서버에 연결한다. 입력한 도메인 이름에 대한 IP주소를 얻은 후 브라우저는 대상 컴퓨터에 연결하여 원하는 웹 페이지를 요청한다. 